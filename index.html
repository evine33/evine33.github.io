<!DOCTYPE html>
<html>
<head>
  <title>Guardar en Dropbox</title>
</head>
<body>
  <h2>Guardar datos en Dropbox</h2>
  <input id="dato" placeholder="Escribe algo">
  <button onclick="iniciarSesion()">Iniciar sesión con Dropbox</button>
  <button onclick="guardarEnDropbox()">Guardar</button>

  <script src="https://unpkg.com/dropbox/dist/Dropbox-sdk.min.js"></script>
  <script>
    const APP_KEY = "mizuaeyfwosrlhx"; // Coloca tu App key aquí
    let dbx;

    function iniciarSesion() {
      const authUrl = `https://www.dropbox.com/oauth2/authorize?client_id=${APP_KEY}&response_type=token&redirect_uri=${location.origin}`;
      window.location.href = authUrl;
    }

    // Si ya tenemos un access_token (después del login), lo usamos
    window.onload = function () {
      const params = new URLSearchParams(window.location.hash.substring(1));
      const accessToken = params.get('access_token');
      if (accessToken) {
        dbx = new Dropbox.Dropbox({ accessToken });
        alert("¡Conectado a Dropbox!");
      }
    }

    function guardarEnDropbox() {
      if (!dbx) {
        alert("Primero inicia sesión con Dropbox.");
        return;
      }

      const contenido = document.getElementById("dato").value;
      dbx.filesUpload({
        path: '/mi_archivo.txt',
        contents: contenido,
        mode: 'overwrite'
      })
      .then(response => {
        alert("¡Archivo guardado!");
        console.log(response);
      })
      .catch(error => {
        alert("Error al guardar");
        console.error(error);
      });
    }
  </script>
</body>
</html>
